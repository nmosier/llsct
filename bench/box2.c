#include "bench.h"

#include <string.h>
#include <assert.h>

#include "sodium.h"

static unsigned char bobsk[32] = { 0x5d, 0xab, 0x08, 0x7e, 0x62, 0x4a, 0x8a,
                                   0x4b, 0x79, 0xe1, 0x7f, 0x8b, 0x83, 0x80,
                                   0x0e, 0xe6, 0x6f, 0x3b, 0xb1, 0x29, 0x26,
                                   0x18, 0xb6, 0xfd, 0x1c, 0x2f, 0x8b, 0x27,
                                   0xff, 0x88, 0xe0, 0xeb };

static unsigned char alicepk[32] = { 0x85, 0x20, 0xf0, 0x09, 0x89, 0x30, 0xa7,
                                     0x54, 0x74, 0x8b, 0x7d, 0xdc, 0xb4, 0x3e,
                                     0xf7, 0x5a, 0x0d, 0xbf, 0x3a, 0x0d, 0x26,
                                     0x38, 0x1a, 0xf4, 0xeb, 0xa4, 0xa9, 0x8e,
                                     0xaa, 0x9b, 0x4e, 0x6a };

static const unsigned char small_order_p[crypto_box_PUBLICKEYBYTES] = {
    0xe0, 0xeb, 0x7a, 0x7c, 0x3b, 0x41, 0xb8, 0xae, 0x16, 0x56, 0xe3,
    0xfa, 0xf1, 0x9f, 0xc4, 0x6a, 0xda, 0x09, 0x8d, 0xeb, 0x9c, 0x32,
    0xb1, 0xfd, 0x86, 0x62, 0x05, 0x16, 0x5f, 0x49, 0xb8, 0x00
};

static unsigned char nonce[24] = { 0x69, 0x69, 0x6e, 0xe9, 0x55, 0xb6,
                                   0x2b, 0x73, 0xcd, 0x62, 0xbd, 0xa8,
                                   0x75, 0xfc, 0x73, 0xd6, 0x82, 0x19,
                                   0xe0, 0x03, 0x6b, 0x7a, 0x0b, 0x37 };

void box2_bench(unsigned char *c, unsigned char *m, size_t len) {
    unsigned char k[crypto_box_BEFORENMBYTES];
    int           i;
    int           ret;

    if (len < 16) {
      return;
    }
    memset(c, '\0', 16);

    crypto_box_open(m, c, len, nonce, alicepk, bobsk);
    ret = crypto_box_open(m, c, len, nonce, small_order_p, bobsk);
    assert(ret == -1);

    memset(m, 0, sizeof m);
    ret = crypto_box_beforenm(k, small_order_p, bobsk);
    assert(ret == -1);
    ret = crypto_box_beforenm(k, alicepk, bobsk);
    assert(ret == 0);
    crypto_box_open_afternm(m, c, 163, nonce, k);
}

